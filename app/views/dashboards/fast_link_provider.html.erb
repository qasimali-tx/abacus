<div id="container-fastlink">
  <div style="text-align: center;">

    <%= hidden_field_tag :field_name, "#{current_user.yodlee_account_token}", :id => 'field_name' %>
    <input type="submit" id="btn-fastlink" class="btn btn-dark py-2 px-5 font-16 " value="Link an Account">
  </div>
</div>

<script>
    $(document).on('turbolinks:load', function() {
    var yodlee_account_token = $('#field_name').val();
    var url = "<%= ENV["FAST_LINK_KEY"] %>";
    (function (window) {
        //Open FastLink
        var fastlinkBtn = document.getElementById('btn-fastlink');
        fastlinkBtn.addEventListener(
            'click',
            function() {
                window.fastlink.open({
                        fastLinkURL: url,
                        accessToken: 'Bearer '+yodlee_account_token,
                        params: {
                            configName : 'Aggregation'
                        },
                        onSuccess: function (data) {
                            // will be called on success. For list of possible message, refer to onSuccess(data) Method.
                            console.log(data);
                        },
                        onError: function (data) {
                            // will be called on error. For list of possible message, refer to onError(data) Method.
                            console.log(data);
                        },
                        onClose: function (data) {
                            window.location.href = "/";
                            // will be called called to close FastLink. For list of possible message, refer to onClose(data) Method.
                            console.log(data);
                        },
                        onEvent: function (data) {
                            // will be called on intermittent status update.
                            console.log(data);
                        }
                    },
                    'container-fastlink');
            },
            false);
    }(window));
    });
</script>